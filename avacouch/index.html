<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Pouch Example</title>
    <!--[if IE]>
      <script src="style/ie.js"></script>
    <![endif]-->
  </head>
  <body>

  <h1> Borrar </h1>
  Id a Borrar: <input type="text" id="idaborrar">
  <input type="submit" id="borrar" value="Borrar"> 
  <br>
  <br>

  <h1> Buscar </h1>
    Id a Buscar: <input id="idabus"></br></br>
  <button type="submit" id="traer">Traer</button>
  <br>

  <h1> Modificar </h1>
    Id a Modificar: <input id="idabuscar"></br></br>
    <br>
    <br>
    <h2>Datos a Modif: </h2>
    <br>
      Nombre: <input id="nombre"></br></br>
      Apellido: <input id="apellido"></br></br>
      Direccion: <input id="direccion"></br></br>
      Telefono: <input id="telefono"></br></br>
    <input type="submit" id="modif" value="Modificar">
<br>
  <h1>Campos</h1>
  </br></br>
  Nombre: <input id="nombre"></br></br>
  Apellido: <input id="apellido"></br></br>
  Direccion: <input id="direccion"></br></br>
  Telefono: <input id="telefono"></br></br>

  <button type="submit" id="grabar">Grabar</button>
  
  <h1> Listar Todos los Json </h1>
  <button type="submit" id="listar">Listar Json's</button>
  <br>
  </body>
    </html>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="https://cdn.jsdelivr.net/pouchdb/4.0.0/pouchdb.min.js"></script>
  <script>  

    var db = new PouchDB('http://jfsmc.iriscouch.com/avaresto');

    $("#traer").click(function() {
    db.get($('#idabus').val()).then(function (doc) {
            document.write(doc.nombre);     
        }).catch(function (err) {
           console.log(err);
      });
    });

    $("#listar").click(function() {
         db.allDocs({
            include_docs: true,
            attachments: true
      }).then(function (result) {
             
             var tabla   = document.createElement("table");
             var tblBody = document.createElement("tbody");

        $.each(result.rows, function(rows,doc) {
             
              var body = document.getElementsByTagName("body")[0];
              var hilera = document.createElement("tr");
              var celda = document.createElement("td");
              var celda2 = document.createElement("td");
              var celda3 = document.createElement("td");
              var celda4 = document.createElement("td");

              var textoCelda2 = document.createTextNode(doc.doc.nombre);
              var textoCelda3 = document.createTextNode(doc.doc.apellido);
              var textoCelda4 = document.createTextNode(doc.doc.direccion);
              var textoCelda = document.createTextNode(doc.id);

              celda.appendChild(textoCelda);
              celda2.appendChild(textoCelda2);
              celda3.appendChild(textoCelda3);
              celda4.appendChild(textoCelda4);
              hilera.appendChild(celda);
              hilera.appendChild(celda2);
              hilera.appendChild(celda3);
              hilera.appendChild(celda4);
              tblBody.appendChild(hilera);
              tabla.appendChild(tblBody);
              body.appendChild(tabla);
              tabla.setAttribute("border", "2");
              $('#listar').attr("disabled", true);
        }); 
      }).catch(function (err) {
          console.log(err);
          });
    });

    $("#grabar").click(function() {
      var persona = {
        _id: new Date().toISOString(),
        nombre: $('#nombre').val(),
        apellido: $('#apellido').val(),
        direccion: $('#direccion').val(),
        telefono: $('#telefono').val()
      };
      db.put(persona, function callback(err, result) {
        if (!err) {
          console.log('Successfully posted a todo!');
        }
      });
    });

      $('#modif').click(function(){
          db.get($('#idabuscar').val()).then(function (doc) {
                doc.nombre =  $('#nombre').val();
                doc.apellido =  $('#apellido').val();
                doc.direccion = $('#direccion').val();
                doc.telefono = $('#telefono').val();
              return db.put(doc);
          }).catch(function (err) {
              console.log(err);
          });
    });

   $('#borrar').click(function(){
      db.get($('#idaborrar').val()).then(function (doc) {
             doc._deleted = true;
             return db.put(doc);                 
      });
   });   

  </script>
